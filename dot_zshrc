# For chezoi plugins
path+=$HOME/.local/bin
fpath+=("$(brew --prefix)/share/zsh/site-functions")
export PATH

# Prompt
autoload -U promptinit; promptinit
prompt pure

# kubectl context/ns
source ~/.local/share/zsh/kubectl.zsh
_lineup=$'\e[1A'
_linedown=$'\e[1B'
_kutl='%F{red}$ZSH_KUBECTL_PROMPT%f'
RPROMPT=%{${_lineup}%}${_kutl}%{${_linedown}%}

# Dev envs
eval "$(/opt/homebrew/bin/mise activate zsh)"
export CLICOLOR=1

# Shell history
eval "$(atuin init zsh)"

# Little bit less dumb vi
export EDITOR=nvim

# Bitwarden ssh agent
#export SSH_AUTH_SOCK=$HOME/.bitwarden-ssh-agent.sock
export SSH_AUTH_SOCK=$HOME/Library/Containers/com.bitwarden.desktop/Data/.bitwarden-ssh-agent.sock

# Autocomplete scaffold
autoload -Uz compinit
compinit
source <(kubectl completion zsh)
# use same completions for kubecolor as kubectl
compdef kubecolor=kubectl

# Set the damn WP
wallpaper () { automator -i "${1}" ~/Documents/SetBackground.workflow }

# Simple aliases
alias kubectl=kubecolor
alias k=kubectl
alias ls=eza
alias cf='chezmoi fzf'
alias df=duf
alias top=btop
alias cat=bat
alias dig=doggo
alias grep=rg
# Delete all failed sgbackup resources in a cluster
delete-failed-sgbackups() {
  local dry_run="--dry-run=client"
  if [[ "$1" == "--no-dry-run" ]]; then
    dry_run=""
  fi
  kubectl get sgbackups -A -o yaml | yq '.items[] | select(.status.process.status == "Failed") | .metadata.namespace + " " + .metadata.name' | xargs -I {} bash -c "kubectl delete sgbackup -n \$(echo {} | cut -d' ' -f1) \$(echo {} | cut -d' ' -f2) $dry_run"
}

# final sources
source /opt/homebrew/share/zsh-syntax-highlighting/zsh-syntax-highlighting.zsh
